define(function(require,t,n){"use strict";function Re(e){e.preventDefault(),e.stopImmediatePropagation()}function He(e,t){y.set(e,t),y.save()}function Ve(e){W.open(e);var t=a.setTimeout(function(){W.isOpen()||Ve(e),a.clearTimeout(t)},180)}function Be(e,t,n){C.setFileViewFocus(C.WORKING_SET_VIEW),h.execute(m.FILE_OPEN,{fullPath:e,paneId:t}).always(function(){g.focusActivePane()}).done(n)}function ze(e,t,n,a){var i=g.getCurrentlyViewedFile(t);return!i&&n?void Be(n.fullPath,t,function(){a&&Ve(e)}):void((a||i.id!==n.id)&&(i.id===n.id&&a?Ve(e):Be(n.fullPath,t,function(){a&&Ve(e)})))}function je(e,t){h.execute(m.FILE_CLOSE,{file:e,paneId:t}).always(function(){g.focusActivePane()})}function Je(e,t,n){var i=t===O?x:O,o=g._getPane(i);if(!o.getViewForPath(e.fullPath)){var r=n||g.getActivePaneId(),s=o.findInViewList(e.fullPath);-1!==s&&h.execute(m.FILE_CLOSE,{File:e,paneId:t}),g._moveView(t,i,e).always(function(){h.execute(m.FILE_OPEN,{fullPath:e.fullPath,paneId:i}).always(function(){var e=g._getPane(t),n=r===t?e:o;e.trigger("viewListChange"),o.trigger("viewListChange"),a.setTimeout(function(){n.focus(),e._lastFocusedElement=n.$el[0],g.setActivePaneId(r)},1)})})}}function Ge(e,t,n,a){g._moveView(t,a,e,n).always(function(){h.execute(m.FILE_OPEN,{fullPath:e.fullPath,paneId:a}).always(function(){g.focusActivePane(),l.refresh(!0)})})}function Ue(e,t,n){g._moveWorkingSetItem(t,e,n),g.focusActivePane()}function Xe(e,t){var a,n=0;for(a=0;a<e.length;a+=1){if(e[a]===t)return n;1===e[a].nodeType&&(n+=1)}return-1}function Ke(){Ne.removeClass("cw-sortable-dragging").addClass("cw-dragged-index"),De&&De.length&&(De.is(":visible")||De.show()),Oe&&(Oe=!1,Fe.remove()),xe&&(xe=!1,Ae.remove())}function Ye(e,t,n){t!==n?Ue(t,e,n):Ke()}function Ze(e,t,n,a,i){if(e!==t){var o=g.findInWorkingSet(t,i.fullPath);o>-1&&(Se=!0,e=t,n=o)}var r=0;if(a){var s=a.getElementsByClassName("cw-dragged-index"),l=a.getElementsByClassName("cw-sortable-placeholder")[0];l?r=Xe(s,l):(r=0,Pe=!0)}else r=n;if(e!==t)Ge(i,e,r,t);else{if(Se)return Se=!1,Pe?(Pe=!1,void Ke()):void Ye(e,n,r);Ye(e,n,r)}}function qe(e){if(!ke){if("dragover"===e.type)return e.originalEvent.dataTransfer.dropEffect="move",!1;if("dragenter"===e.type){if("LI"===e.target.tagName){var t=_e;_e=e.currentTarget.id;var n=$("#"+_e);Me||(Te=e.currentTarget,Me=Te.attributes["data-paneid"].value);var a=$(e.target);if(a[0]!==Fe[0]&&(De=$(".cw-dragli-"+Le.id,n),De.length&&De.is(":visible")&&De.removeClass("cw-dragged-index").hide(),n.find(Ae).length||(Ae.data(D,0).prependTo(n),xe=!0),a.after(Fe),Oe=!0,t&&_e&&t!==_e)){var i=$(".cw-dragli-"+Le.id,$("#"+t));i.is(":visible")||i.addClass("cw-dragged-index").show()}}return e.stopPropagation(),e.preventDefault(),!1}"UL"===e.currentTarget.tagName&&($e=!1,Te=e.currentTarget,Me=Te.attributes["data-paneid"].value,Ze(ye,Me,We,Te,Le))}}function Qe(e){var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(a.innerHeight||i.documentElement.clientHeight)&&t.right<=(a.innerWidth||i.documentElement.clientWidth)}function et(e,t,n,a){if(t=g.getCurrentlyViewedFile(e)){var i=g.findInWorkingSet(e,t.fullPath);if(!(0>i)&&a[0].scrollWidth>n.width()){var s,o=function(e){if(e=e[0],!Qe(e)){var t=e.offsetLeft,i=a[0].scrollWidth-n.width(),o=t>i?i:t;a.data("scrollwheel",o),a.stop().animate({scrollLeft:o},300)}},r=$(".cw-dragli-"+t.id,a);r.length?(clearInterval(s),o(r)):s=setInterval(function(){r=$(".cw-dragli-"+t.id,a),r.length&&(clearInterval(s),o(r))},10)}}}function tt(e){return Ee.getElementsByClassName(e)[0]}function nt(e){tt("cw-parentPath").innerHTML=e.parentPath,p.getDocumentForPath(e.fullPath).done(function(t){tt("cw-date").innerHTML=t.diskTimestamp;var n=t?t.isDirty:!1;e.stat(function(e,t){e?tt("cw-size").innerHTML="...":tt("cw-size").innerHTML=(n?"&#177;":"")+s.prettyPrintBytes(t.size.valueOf())});var a=t.getText();tt("cw-chars").innerHTML=a.length,tt("cw-lines").innerHTML=s.getLines(a).length,tt("cw-le").innerHTML=b.sniffLineEndings(a)||t._lineEndings,tt("cw-language").innerHTML=t.language.getId(),tt("cw-hash").innerHTML=t.diskTimestamp.valueOf()}),tt("cw-id").innerHTML=e.id}function at(e){$("#cw-arrow").css("left",e.clientX-Ee.offsetLeft)}function it(e,t,n,i,o){var d,r=e-t/2,s=i+o,l=a.outerWidth,c=a.outerHeight,f=t>l||0>r?1:r>l-t?l-t-1:r;return n>s||c>s+n?(d=s,Ee.className="cw-tabbar-tooltip cw-arrow-bottom"):(d=i-n+6,Ee.className="cw-tabbar-tooltip cw-arrow-top"),{top:d,left:f}}function ot(e,t,n,i){if(Q)if(te)ne&&(Ee.style.display="none",ae=!1,ee=0,ne=!1);else if(e=a.event||e,ee+=1,ee>2&&(ae&&at(e),!ne)){ne=!0,nt(n),ae=!0,Ee.style.display="block";var o=$("#cw-"+t+"-tabbar"),r=o.outerHeight(),s=o.offset().top,l=Ee.getBoundingClientRect().width||Ee.offsetWidth,c=Ee.getBoundingClientRect().height||Ee.offsetHeight,f=it(e.pageX,l,c,s,r),d=it(e.pageX,Ee.getBoundingClientRect().width,Ee.getBoundingClientRect().height,s,r);if(Ee.style.top=d.top+"px",Ee.style.left=d.left+"px",i)return f}}function rt(){a.setTimeout(function(){if(q&&T.hasClass("cw-force-display")&&!M.hasClass("cw-sidebar")){if(S.isOpen()||W.isOpen()||$("#project-dropdown").is(":visible")||$(".jstree-rename-input",T).length||$(".open-files-container.wsv-drag-ghost").length)return;T.css("z-index",oe),T.removeClass("cw-force-display"),M.addClass("cw-sidebar"),oe=void 0}},55)}function st(e){return $(i.createElement("div")).addClass("cw-flipview-content"+(e?" cw-height":"")).hide().mousedown(function(e){e.stopPropagation()})}function lt(e,t){return $(i.createElement("div")).addClass("cw-icon-cw cw-close-file cw-height").mousedown(function(e){e.preventDefault()}).attr("title",o.CMD_FILE_CLOSE).click(function(n){je(e,t),n.stopPropagation()})}function ct(e){return $(i.createElement("div")).addClass("cw-icon-cw cw-file-rename").attr("title",o.CMD_FILE_RENAME).click(function(t){var n=$(this).parent().parent();n.removeAttr("draggable"),n.append(function(){return $(i.createElement("div")).addClass("cw-actions-boxrename").append(function(){return $(i.createElement("input")).attr({value:e.name,"class":"cw-actions-rename"}).on("change",function(){var t=$(this).next(),n=e.parentPath+$(this).val();e.rename(n,function(e){e&&t.addClass("cw-needcancel").attr("title",r.NOT_READABLE)})})}).append(function(){return $(i.createElement("div")).attr({"class":"cw-icon-cw cw-close-file cw-actions-cancelrename",title:o.CANCEL}).on("click",function(e){var t=$(this).parent();t.next().remove(),t.remove(),n.attr("draggable",!0),e.stopPropagation()})}).on("click",function(e){e.stopPropagation()})}).append(function(){return $(i.createElement("div")).addClass("cw-actions-minspace")}),t.stopPropagation()})}function ft(e){return $(i.createElement("div")).addClass("cw-icon-cw cw-showinos-file").attr("title",o.CMD_SHOW_IN_EXPLORER).click(function(t){brackets.app.showOSFolder(e.fullPath,function(t){t&&console.error("Error showing '"+e.fullPath+"' in OS folder:",t)}),t.stopPropagation()})}function dt(e){return $(i.createElement("div")).addClass("cw-icon-cw cw-icon-trash").attr("title",o.DELETE).click(function(t){c.deleteItem(e),t.stopPropagation()})}function ut(e){return"InMemoryFile"===e.constructor.name}function gt(e,t){var n=$(i.createElement("div")).addClass("cw-file-actions");return ut(e)?n.append(lt(e,t)):n.append(ft(e,t)).append(ct(e,t)).append(dt(e,t)).append(lt(e,t)),n}function pt(e,t,n,i){var o=g.setLayoutScheme(e,t);o&&a.setTimeout(function(){Je(n,i,x)},1)}function wt(e,t,n,i,o){var r=n===O?x:O;if(e){var s=g.setLayoutScheme(i,o);s&&a.setTimeout(function(){Be(t,r)},1)}else Be(t,r)}function mt(e,t,n,a,r,l){if(!(t&&(a.addClass("cw-li-bg"),a.outerWidth()<=47))&&(a.addClass("cw-btns"),!t||n)){var c=g.getPaneCount(),f={"first-pane":[o.BOTTOM,o.RIGHT],"second-pane":[o.TOP,o.LEFT]},d=o.FLIPVIEW_BTN_TOOLTIP||"Flip this view to {0} pane";if(2>c)r.removeAttr("title"),r.removeClass("cw-icon-cw "+Y[e].join(" ")),r.append($(i.createElement("div")).addClass("cw-icon-cw cw-flipview-btn "+Y[e][1]).attr("title",s.format(d,f[e][1])).on("click",function(t){2===t.which?(wt(!0,l.fullPath,e,1,2),t.preventDefault()):pt(1,2,l,e),t.stopPropagation()})),r.append($(i.createElement("div")).addClass("cw-icon-cw cw-flipview-btn "+Y[e][0]).attr("title",s.format(d,f[e][0])).on("click",function(t){2===t.which?(wt(!0,l.fullPath,e,2,1),t.preventDefault()):pt(2,1,l,e),t.stopPropagation()}));else{r.removeClass(Y[e].join(" "));var u=g.getLayoutScheme();r.addClass("cw-icon-cw "+Y[e][u.columns-1]).attr("title",s.format(f[e][u.columns-1])).on("click",function(t){2===t.which?(wt(!1,l.fullPath,e),t.preventDefault()):Je(l,e),t.stopPropagation()})}r.show()}}function ht(e,t,n,a,o,r){var s=t.data(N),l=t.attr("class")||"",c="cw-dragged-index,"+(l?l+",":"")+"cw-dragli-"+s.id,f=st(a),d=$(i.createElement("li")).mousedown(function(t){t.stopPropagation(),te=!0,2===t.which&&(t.preventDefault(),je(s,e))}).mouseup(function(){te=!1}).click(function(t){1===t.which&&(t.preventDefault(),ze(t,e,s))}).contextmenu(function(t){t.preventDefault(),3===t.which&&ze(t,e,s,!0)}).on("mouseenter",function(){mt(e,a,r,$(this),f,s)}).on("mouseleave",function(){a||f.hide().empty(),a&&($(this).removeClass("cw-li-bg"),r&&f.hide().empty()),$(this).removeClass("cw-btns"),a&&Q&&ne&&(Ee.style.display="none",ae=!1,ee=0,ne=!1)}).on("mousemove",function(t){a&&ot(t,e,s)}).data(D,n+1).on("dragstart",function(t){ke=!1;var a=$(this);ye=e,We=n,Le=s,Ne=a.removeClass("cw-dragged-index").addClass("cw-sortable-dragging"),t.originalEvent.dataTransfer.setData("text/plain",s.fullPath),t.originalEvent.dataTransfer.effectAllowed="move",Fe.html(a.html()),g.getPaneCount()>1&&$(".horz-resizer").addClass("cw-zIndex-minus")}).on("dragend",function(){te=!1,ke||(ke=!0,Oe&&xe&&$e&&Ze(ye,Me,We,Te,Le),ye=void 0,We=void 0,Le=void 0,Me=void 0,Te=void 0,_e=void 0,Ne=void 0,De=void 0,$e=!0,g.getPaneCount()>1&&$(".horz-resizer").removeClass("cw-zIndex-minus"))}).attr("draggable",!0).append(t.html());return a?(r&&d.append(f),d.append(lt(s,e)),c+=",cw-height",d.attr({title:s.name}),o||l.indexOf("selected")>-1&&d.width(49)):(d.append(f),d.append(gt(s,e))),d.addClass(c.replace(/,/g," ")),d}function vt(e,t,n,a){if(t.hasClass("cw-close-tabmenu")){n.removeClass("cw-close-tabmenu"),n.attr("title","Hide Tab Menu");var i=g.getWorkingSetSize(e),r=2===i?o.FIND_IN_FILES_FILE:o.FIND_IN_FILES_FILES;$(".cw-tabmenu-files-length",t).html(i+" "+r),a.empty(),$("ul > li",$("#working-set-list-"+e+" .open-files-container")).each(function(t){a.append(ht(e,$(this),t,!1))}),t.removeClass("cw-close-tabmenu")}else n.addClass("cw-close-tabmenu"),n.attr("title","Show Tab Menu"),t.addClass("cw-close-tabmenu")}function Ct(e){h.execute(m.FILE_CLOSE_LIST,{fileList:g.getWorkingSet(e)}),e===x&&L.get("pane.mergePanesWhenLastFileClosed")&&g.setLayoutScheme(1,1)}function bt(e,t,n){var i=g._getPane(n);g._getPane(t).removeViews(e),i.addListToViewList(e),l.refresh(!0),a.setTimeout(function(){g.setActivePaneId(n),i.focus()},3)}function It(e){var t=g.getWorkingSet(e),n=e===O?x:O,a=g.getPaneCount(),i=g.getCurrentlyViewedFile(e);if(a>1){var o=g.getCurrentlyViewedFile(n);bt(t,e,n),!o&&i&&h.execute(m.FILE_OPEN,{fullPath:i.fullPath,paneId:n})}else{var r=g.setLayoutScheme(2,1);r&&(bt(t,e,n),i&&h.execute(m.FILE_OPEN,{fullPath:i.fullPath,paneId:n}))}}function Et(e){if(e.preventDefault(),e=a.event||e,e.ctrlKey)return void(e.wheelDelta>=0?h.execute(m.NAVIGATE_PREV_DOC_LIST_ORDER):h.execute(m.NAVIGATE_NEXT_DOC_LIST_ORDER));if(y.get(H.CWs)){var t=$(e.currentTarget);if(t.children().length&&t[0].scrollWidth>t.parent().width()){var n=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail)),i=t.data(H.CWs),o=0>n?ie+i:i-ie,r=t[0].scrollWidth-t.parent().width(),s=o>r?r:0>o?0:o;t.data(H.CWs,s),t.scrollLeft(t.data(H.CWs))}}}function kt(e,t){a.localStorage.setItem(e,t)}function $t(){var l,e=brackets.getModule("filesystem/FileSystem"),t=$("#cwb-body"),n=JSON.parse(a.localStorage.getItem(j))||{},o=function(e,t){var n=t[1];return t.splice(0,2),$(i.createElement("li")).attr({"class":"cwb-items",title:e}).on("click",function(t){t.preventDefault(),Be(e,g.ACTIVE_PANE)}).html(n+'<span class="cwb-lines">'+t.join(" ")+"</span>").append(function(){return $(i.createElement("span")).addClass("cwb-close").on("click",function(t){var n=JSON.parse(a.localStorage.getItem(j))||{},i=s.hashCode(e.replace(/\W/g,""));delete n[i],kt(j,JSON.stringify(n)),$(this).parent().remove(),t.stopPropagation()}).html("x")})},r=function(n){var i=JSON.parse(a.localStorage.getItem(j))||{},r=n[0];if(n&&void 0!==n[2]){var l=e.getFileForPath(r);l.hasOwnProperty("_stat")?t.append(o(r,n)):delete i[s.hashCode(r.replace(/\W/g,""))]}else delete i[s.hashCode(r.replace(/\W/g,""))];kt(j,JSON.stringify(i))};if(Object.keys(n).length){for(l in n)if(n.hasOwnProperty(l)){var c=n[l];r(c)}$("#cwb-clear").on("click",function(e){e.preventDefault(),$(".cwb-bar").empty();var l,n=function(e,t){t.splice(0,2);var n,a=t.length;for(n=0;a>n;n+=1)e.removeLineClass(t[n],"wrap","cw-bookmark")},i=function(e){p.getDocumentForPath(e.fullPath).done(function(e){if(e.hasOwnProperty("_masterEditor")){var t=JSON.parse(a.localStorage.getItem(j))||{},i=s.hashCode(e.file.fullPath.replace(/\W/g,"")),o=t[i];o&&n(e._masterEditor._codeMirror,o)}})},o=g.getWorkingSet(g.ALL_PANES),r=o.length;for(l=0;r>l;l+=1)i(o[l]);a.localStorage.removeItem(j),t.html("")})}else $("#cwb-clear").parent().hide(),t.addClass("cwb-zero not-editor")}function Pt(e,t,n){t!==n&&y.set(e,t)}function St(e,t){var n;for(n in H)if(H.hasOwnProperty(n)){var a=$("#"+n,e);if(t)a.prop(V[a.attr("type")],y.get(H[n]));else{var i=a.prop(V[a.attr("type")]),o=typeof i;"boolean"!==o&&(i=~~i),Pt(H[n],i,y.get(H[n]))}}}function Wt(){if(y.get(H.CWah)){var e=function(){var t=g.getActivePaneId(),n=$("#cw-"+t+"-tabmenu"),a=$("#cw-"+t+"-listview"),o=n.hasClass("cw-close-tabmenu");o||(n.addClass("cw-close-tabmenu"),a.addClass("cw-close-tabmenu")),$(i.body).off("click",e)};$(i.body).on("click",e)}}function Lt(e,t,n,a){$("#"+t).prepend(s.format(e,t)),$("#cw-"+t+"-tabbar").on("contextmenu",Re),$("#cw-"+t+"-nav-ul").on("drop dragover dragenter",qe).on("mousewheel",Et);var r=$("#cw-"+t+"-tabmenu"),l=$("#cw-"+t+"-tabmenu-ul");$("#cw-"+t+"-listview").click(function(e){e.stopPropagation(),vt(t,r,$(this),l),Wt()}),r.on("contextmenu",Re),$("#cw-"+t+"-prefs").on("click",function(e){e.preventDefault(),Z()}),$("#cw-"+t+"-bookmarks").on("click",function(e){e.preventDefault(),$(i.body).append(a),$t()}),$("#cw-"+t+"-open").on("click",function(e){e.preventDefault(),h.execute(m.FILE_OPEN)}),$("#cw-"+t+"-move-list").on("click",function(e){e.preventDefault(),It(t)}),$("#cw-"+t+"-close-all").on("click",function(e){e.preventDefault(),Ct(t)}),l.on("drop dragover dragenter",qe),$("#cw-"+t+"-hover-sidebar").mouseenter(function(e){e.preventDefault(),q&&!I.isVisible()&&(T.hasClass("cw-force-display")||(oe=T.css("z-index"),T.addClass("cw-force-display"),T.css("z-index",19),M.removeClass("cw-sidebar"))),e.stopPropagation()}),n&&(_=$(".cw-sidebar-btn"),I.isVisible()?_.html("←").attr("title",o.CMD_HIDE_SIDEBAR).addClass("cw-show-sidebar"):_.html("→").attr("title",o.CMD_SHOW_SIDEBAR).removeClass("cw-show-sidebar"),_.click(function(){I.toggle()}))}function yt(e,t){Lt(e,O,!0,t),re=!0,se=$("#cw-first-pane-navbar"),le=$("#cw-first-pane-nav-ul"),ce=$("#cw-first-pane-listview"),fe=$("#cw-first-pane-tabmenu"),de=$(".cw-tabmenu-files-length",fe),ue=$("#cw-first-pane-tabmenu-ul"),ge=$("#working-set-list-first-pane .open-files-container");var n=$(".main-view"),s=!0;y.definePreference(H.CWmt,"boolean",!1,{description:r.CWMT}).on("change",function(){y.get(H.CWmt)?(n.addClass("cw-toolbar-moved"),$("#main-toolbar").insertAfter("#project-files-container"),s=!1):s||(n.removeClass("cw-toolbar-moved"),$("#main-toolbar").insertAfter(".content"))}),g.on("paneCreate",function(){Lt(e,x),pe=!0,we=$("#cw-second-pane-navbar"),me=$("#cw-second-pane-nav-ul"),he=$("#cw-second-pane-listview"),ve=$("#cw-second-pane-tabmenu"),Ce=$(".cw-tabmenu-files-length",ve),be=$("#cw-second-pane-tabmenu-ul"),Ie=$("#working-set-list-second-pane .open-files-container")}),g.on("paneDestroy",function(){pe=!1,we=void 0,me=void 0,he=void 0,ve=void 0,Ce=void 0,be=void 0,Ie=void 0}),y.definePreference(H.CWs,"boolean",!1,{description:r.CWS}).on("change",function(){y.get(H.CWs)?n.removeClass("cw-nonscroll"):n.addClass("cw-nonscroll")}),y.definePreference(H.CWsb,"boolean",!1,{description:r.CWSB}).on("change",function(){$(a).trigger("triggerForCustomWork")});var d=function(e){if(y.get(H.CWui)){if(e.isFile){var o,r,t=e.fullPath,n=v.getLanguageForPath(t),a=n.getId(),s=function(e){var t,n=e.lastIndexOf(".");return t=n>0?e.substr(n+1):b.getBaseName(e)};return"unknown"===a?o="cwi-"+a+" cwi-"+s(t).toLowerCase():(r=v.getCompoundFileExtension(t),o="html"===r?"cwi-"+a+" cwi-html5":r?"cwi-"+a+" cwi-"+r:"cwi-"+a+" cwi-"+s(t)),$(i.createElement("span")).addClass("cwi "+o)}return $(i.createElement("span")).addClass("cwi cw-folder-btn")}};l.addIconProvider(d),f.addIconProvider(d),y.definePreference(H.CWui,"boolean",!1,{description:r.CWUI}).on("change",function(){c.rerenderTree(),l.refresh(!0),$(a).trigger("triggerForCustomWork")}),y.definePreference(H.CWgs,"boolean",!1,{description:r.CWGS}).on("change",function(){y.get(H.CWgs)?n.addClass("cw-grayscale-icons"):n.removeClass("cw-grayscale-icons")}),y.definePreference(H.CWro,"boolean",!1,{description:r.CWRO}).on("change",function(){y.get(H.CWro)?n.addClass("cw-opacity-pane"):n.removeClass("cw-opacity-pane")}),y.definePreference(H.CWwl,"boolean",!1,{description:r.CWWL}).on("change",function(){y.get(H.CWwl)?n.removeClass("cw-swlvols"):n.addClass("cw-swlvols")}),y.definePreference(H.CWgb,"boolean",!1,{description:r.CWGB}).on("change",function(){B=y.get(H.CWgb)?!0:!1,B?n.addClass("cw-bookmarks"):n.removeClass("cw-bookmarks")}),T.on("panelCollapsed",function(){_.html("→").attr("title",o.CMD_SHOW_SIDEBAR).removeClass("cw-show-sidebar"),q&&!I.isVisible()&&M.addClass("cw-sidebar")}),T.on("panelExpanded",function(){_.html("←").attr("title",o.CMD_HIDE_SIDEBAR).addClass("cw-show-sidebar"),q&&I.isVisible()&&M.removeClass("cw-sidebar")}),T.on("mouseleave",rt),M.on("click",rt)}function Mt(e,t,n,a,r,s,l,c){var f=g.getWorkingSetSize(e),d=y.get(H.CWs),u=y.get(H.CWsb),p=s.hasClass("cw-close-tabmenu");if(f)n.empty(),a.addClass("cw-visible"),p||l.empty(),r.find("ul > li").each(function(t){var a=$(this);if(n.append(ht(e,a,t,!0,d,u)),!p){l.append(ht(e,a,t,!1));var i=1===f?o.FIND_IN_FILES_FILE:o.FIND_IN_FILES_FILES;c.html(f+" "+i)}});else{n.html(o.EMPTY_VIEW_HEADER);var w=$("#cw-"+e+"-close"),m=$(i.createElement("div")).attr({"class":"cw-icon-cw cw-close-pane cw-height",title:o.CMD_SPLITVIEW_NONE,id:"cw-"+e+"-close"}).click(function(){g.setLayoutScheme(1,1)});w.length||n.append(m),a.removeClass("cw-visible"),p||s.addClass("cw-close-tabmenu")}}function Tt(){re&&Mt(O,se,le,ce,ge,fe,ue,de),pe&&Mt(x,we,me,he,Ie,ve,be,Ce)}function xt(){_t?(_t=!1,Tt()):Ot||(Ot=setTimeout(function(){Ot=void 0,Tt()},150)),Q&&ne&&(Ee.style.display="none",ae=!1,ee=0,ne=!1)}function Rt(){if(B){if(Ft){var e=$(".CodeMirror.CodeMirror-wrap").filter(":visible");e.each(function(e,t){if(e||(Nt=Dt,Dt=t.offsetHeight,At=Nt!==Dt?!0:!1),At){var n=$(t).find(".CodeMirror-scroll .CodeMirror-gutters")[0].offsetHeight,a=t.offsetHeight,i=$(t).find(".cw-tickmark");i.length&&i.each(function(e,t){var i=~~t.getAttribute("data-top");t.style.top=~~(i/n*a)+"px"})}})}Ft=!0}}function Ht(e){y.get(H.CWs)&&a.setTimeout(function(){re&&et(O,e,se,le),pe&&et(x,e,we,me)},1)}function Vt(e){function c(){re&&(t=o,o=Math.max(i.getElementById("first-pane").clientHeight-83,0),t!==o&&$("#cw-first-pane-tabmenu-box").css("max-height",o)),pe&&(n=l,l=Math.max(i.getElementById("second-pane").clientHeight-83,0),n!==l&&$("#cw-second-pane-tabmenu-box").css("max-height",l))}g.on("currentFileChange",function(){ke&&(xt(),Ht())}),g.on("workingSetSort workingSetMove",function(){xt(),Ht()}),g.on("workingSetAdd workingSetAddList workingSetRemove workingSetRemoveList workingSetUpdate workingSetSort workingSetMove",xt),$(a).on("triggerForCustomWork",xt),p.on("dirtyFlagChange",function(){xt(),Ht()}),p.on("fileNameChange",function(e,t,n){var i=s.hashCode(t.replace(/\W/g,"")),o=s.hashCode(n.replace(/\W/g,"")),r=JSON.parse(a.localStorage.getItem(j));if(r&&r.hasOwnProperty(i)){r[o]=r[i],r[o][0]=n;var l=n.lastIndexOf("/");r[o][1]=n.substr(l+1),delete r[i]}a.localStorage.setItem(j,JSON.stringify(r))}),g.on("paneLayoutChange",function(e,t){"HORIZONTAL"===t?($("#cw-"+O+"-move-list").html(K[0]),$("#cw-"+x+"-move-list").html(K[1])):"VERTICAL"===t?($("#cw-"+O+"-move-list").html(K[2]),$("#cw-"+x+"-move-list").html(K[3])):$("#cw-"+O+"-move-list").html(K[0])});var f,t=0,n=0,o=0,l=0;w.on("workspaceUpdateLayout",function(){var e;f&&clearTimeout(f),f=setTimeout(function(){Ht(),c(),Rt(),f=e},501)}),$("#first-pane").on("panelResizeEnd",function(){c(),Rt()}),T.on("panelResizeEnd",c),y.definePreference(H.CWah,"boolean",!1,{description:r.CWAH}),y.definePreference(H.CWts,"boolean",!1,{description:r.CWTS}).on("change",function(){y.get(H.CWts)?(q=!0,I.isVisible()||M.addClass("cw-sidebar")):(q=!1,M.removeClass("cw-sidebar"))}),y.definePreference(H.CWss,"number",50,{description:r.CWSS}).on("change",function(){ie=y.get(H.CWss),"number"!=typeof ie&&(ie=~~y.get(H.CWss)),ie||(ie=50,He(H.CWss,50))}),y.definePreference(H.CWt,"boolean",!1,{description:r.CWT}).on("change",function(){y.get(H.CWt)?Q||($(i.body).append(e),Ee=i.getElementById("cw-tabbar-tooltip"),Q=!0,Ee.onmouseover=function(){te||(Ee.style.display="block")},Ee.onmouseout=function(){te||(Ee.style.display="none")}):Q&&(Ee.remove(),Ee=void 0,Q=!1)})}function Bt(){var e=g.getActivePaneId(),t=$("#cw-"+e+"-listview"),n=$("#cw-"+e+"-tabmenu"),a=$("#cw-"+e+"-tabmenu-ul");vt(e,n,t,a)}function zt(e,t,n,i,o){var r=e?"sessionStorage":"localStorage",l=s.hashCode(n.replace(/\W/g,"")),c=JSON.parse(a[r].getItem(j))||{};if(c[l]||(c[l]=[n,i]),t)c[l].push(o);else{var f=c[l].indexOf(o);f>-1&&c[l].splice(f,1)}a[r].setItem(j,JSON.stringify(c))}function jt(e,t,n,i){var o=e?"sessionStorage":"localStorage",r=s.hashCode(t.replace(/\W/g,"")),l=JSON.parse(a[o].getItem(j))||{},c=[t,n].concat(i);l[r]=c,a[o].setItem(j,JSON.stringify(l)),c=void 0}function Jt(e,t,n,a){return $(i.createElement("div")).attr({"class":"cw-tickmark cwt-"+a,"data-top":t,"data-line":a}).css("top",n+"px").on("click",function(){e.setCursorPos($(this).data("line"),0)})}function Gt(e,t,n,i){var o=i?"sessionStorage":"localStorage",r=JSON.parse(a[o].getItem(j));if(r){var l=n[0].className.indexOf("cwb-current");if(-1===l){var c=e.getFile().fullPath,f=s.hashCode(c.replace(/\W/g,"")),d=r[f];if(d&&void 0!==d[2]){n.addClass("cwb-current");var w,u=e.totalHeight(),g=n[0].clientHeight,p=d.length;for(w=2;p>w;w+=1){var m=t.getLineHandle(d[w]);if(m){t.addLineClass(d[w],"wrap","cw-bookmark");var h=t.charCoords({line:d[w],ch:0},"local").top,v=~~(h/u*g);$(".cwb-bar",n).append(Jt(e,h,v,d[w]))}}}}}}function Ut(e,t,n){var i=n?"sessionStorage":"localStorage",o=JSON.parse(a[i].getItem(j));if(o){var r=e.getFile().fullPath,l=s.hashCode(r.replace(/\W/g,"")),c=o[l];if(c&&void 0!==c[2]){var d,f=c.length;for(d=2;f>d;d+=1){var u=t.getLineHandle(c[d]);u&&t.addLineClass(c[d],"wrap","cw-bookmark")}}}}function Xt(e,t,n,i,o,r){var l,c,d,s=$(".cwb-bar",n),f=0,u=e.getFile(),g=u.fullPath,p=u.name,w=[];s.empty(),d||(d=a.setTimeout(function(){for(d=void 0,c=0;r>c;c+=1){l=e._codeMirror.lineInfo(c);var a=l.wrapClass;if(a&&a.indexOf("cw-bookmark")>-1){f+=1;var u=l.line,m=e.totalHeight(),h=n[0].clientHeight,v=t.charCoords({line:u,ch:0},"local").top,C=~~(v/m*h);s.append(Jt(e,v,C,u)),w.push(u)}if(o===f)break;r!==c+1||f||Ut(e,t,i)}f>0&&(jt(i,g,p,w),w=void 0)}))}function Yt(e,t,n,a){var i=$(".cwb-bar",n);t.on("gutterClick",function(t,o,r,s){Kt||(Kt=setTimeout(function(){if(Kt=void 0,"CodeMirror-linenumbers"===r){var l=o||0,c=t.lineInfo(l),f=e.getFile(),d=f.fullPath,u=f.name,g=parseInt(n.css("height"),10),p=e.totalHeight();if(c.wrapClass&&-1!==c.wrapClass.indexOf("cw-bookmark"))t.removeLineClass(l,"wrap","cw-bookmark"),$(".cwt-"+l,n).remove(),zt(a,!1,d,u,l);else{t.addLineClass(l,"wrap","cw-bookmark");var w=s.offsetY,m=~~(w/p*g);i.append(Jt(e,w,m,l)),zt(a,!0,d,u,l)}}},8))})}function Zt(e){var t=$(i.createElement("textarea"));t.val(e),t.prependTo("body"),t.select(),window.document.execCommand("copy"),t.remove()}function qt(){var e=u.getActiveEditor().getFile().fullPath;Zt(e)}function Qt(){var e=c.getSelectedItem();if(e){var t=c.getSelectedItem().fullPath;Zt(t)}else Zt(c.getInitialProjectPath())}function cn(){nn||(nn=a.setTimeout(function(){nn=void 0;var e=$(".cw-tickmark",an),t=e.length;t&&(tn=en,en=on.lineCount(),(en>tn||tn>en)&&Xt(on,rn,an,sn,t,en))},15))}function fn(e,t){h.register(F,A,qt),k.addMenuItem(A,"",E.FIRST),P.addMenuItem(A,"",E.FIRST),W.addMenuItem(A,"",E.FIRST),h.register(F,R,Qt),S.addMenuItem(R,"",E.FIRST),u.on("activeEditorChange",function(e,t,n){if(on=t,t&&(B&&(delete sessionStorage[j],en=t.lineCount()),ln=t.document,B)){an=$(t.getRootElement()),rn=t._codeMirror,sn=ln.isUntitled();var a=$(i.createElement("div")).attr({"class":"cwb-bar"});$(".cwb-bar",an).length||an.append(a),Gt(t,rn,an,sn),Yt(t,rn,an,sn),ln.on("change",cn)}}),h.register("custom-work-for-brackets-listview",z,Bt),d.addBinding(z,"Ctrl-Shift-V","all");var n=a.setTimeout(function(){var i;i=170>U?Mustache:brackets.getModule("thirdparty/mustache/mustache"),X=i.render(e,r),G||(kt(J,t),Z(!0)),t>parseInt(G,10)&&(kt(J,t),Z()),localStorage.getItem("cw-version-in-localStorage")&&localStorage.removeItem("cw-version-in-localStorage"),a.clearTimeout(n)},1e3)}var _,X,Z,ie,oe,se,le,ce,fe,de,ue,ge,we,me,he,ve,Ce,be,Ie,Ee,We,Le,ye,Me,Te,_e,Ne,De,Ot,Kt,en,tn,nn,an,on,rn,sn,ln,a=window,i=a.document,o=brackets.getModule("strings"),r=require("i18n!nls/strings"),s=brackets.getModule("utils/StringUtils"),l=brackets.getModule("project/WorkingSetView"),c=brackets.getModule("project/ProjectManager"),f=brackets.getModule("project/FileTreeView"),d=brackets.getModule("command/KeyBindingManager"),u=brackets.getModule("editor/EditorManager"),g=brackets.getModule("view/MainViewManager"),p=brackets.getModule("document/DocumentManager"),w=brackets.getModule("view/WorkspaceManager"),m=brackets.getModule("command/Commands"),h=brackets.getModule("command/CommandManager"),v=brackets.getModule("language/LanguageManager"),C=brackets.getModule("project/FileViewController"),b=brackets.getModule("file/FileUtils"),I=brackets.getModule("project/SidebarView"),E=brackets.getModule("command/Menus"),k=E.getContextMenu(E.ContextMenuIds.EDITOR_MENU),P=E.getContextMenu(E.ContextMenuIds.INLINE_EDITOR_MENU),S=E.getContextMenu(E.ContextMenuIds.PROJECT_MENU),W=E.getContextMenu(E.ContextMenuIds.WORKING_SET_CONTEXT_MENU),L=brackets.getModule("preferences/PreferencesManager"),y=L.getExtensionPrefs("custom.work"),M=$(".content"),T=$("#sidebar"),O="first-pane",x="second-pane",N="file",D="index",F="Copy Path",A="custom.work.copypatheditor",R="custom.work.copypathproject",H={CWui:"useIconsOfCustomWork",CWmt:"moveToolbarToSidebar",CWgs:"grayScaleIcons",CWgb:"gutter.bookmark",CWts:"toggle.sidebar",CWro:"reduce.opacity",CWsb:"splitButton",CWah:"autoHideTheTabmenu",CWt:"tooltip",CWs:"scrollwheel",CWss:"scrollwheel.step",CWwl:"showWorkingListViewonLeftSidebar"},V={checkbox:"checked",number:"value"},B=!1,z="customworkKeyIdListView",j="custom.work.bookmarks",J="custom.work.addon.version",G=localStorage.getItem(J),U=~~brackets.metadata.apiVersion.replace(/\D+/g,""),K=["&dArr;","&uArr;","&rAarr;","&lArr;","&hArr;"],Y={"all-panes":["cw-flipview-icon-none"],"first-pane":["cw-flipview-icon-bottom","cw-flipview-icon-right"],"second-pane":["cw-flipview-icon-top","cw-flipview-icon-left"]},q=!1,Q=!1,ee=0,te=!1,ne=!1,ae=!1,re=!1,pe=!1,ke=!0,$e=!0,Pe=!1,Se=!1,Oe=!1,xe=!1,Fe=$(i.createElement("li")).addClass("cw-height cw-dragged-index cw-sortable-placeholder"),Ae=$(i.createElement("li")).addClass("cw-height cw-li-zero"),_t=!0,Nt=0,Dt=0,Ft=!1,At=!1;Z=function(e){var t=brackets.getModule("widgets/Dialogs"),n=t.showModalDialogUsingTemplate(X,!0),a=n.getElement();e||St(a,!0),n.done(function(e){if("cancel"!==e&&"dontsave"!==e&&"ok"===e){St(a),y.save(),Wt(),ln&&ln.on("change",cn);var n=t.showModalDialog("cw-reloaddialog",r.NAME_EXTENSION,r.DIALOG_RELOAD,[{className:t.DIALOG_BTN_CLASS_PRIMARY,id:t.DIALOG_BTN_OK,text:"reload now"},{className:t.DIALOG_BTN_CLASS_LEFT,id:t.DIALOG_BTN_CANCEL,text:"reload later"}]);n.done(function(e){"ok"===e&&h.execute(m.APP_RELOAD)})}})},n.exports={html:yt,extension:Vt,ready:fn}});